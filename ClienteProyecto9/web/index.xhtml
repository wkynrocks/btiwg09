<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <title>Buscador Tesoros</title>
        
        <script type="text/javascript">
            
            function getXMLHttpRequest(){
                var xmlhttp;
                if(window.XMLHttpRequest){
                    // IE7+, Firefox, Chrome, Opera, Safari
                    xmlhttp = new XMLHttpRequest();
                }else{
                    // IE6, IE5
                    xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                }
                return xmlhttp;
            }

            function llamarServidorRemoto(){
                var xmlhttp = getXMLHttpRequest();
                /*
                 * En lugar de llamar a la URL remota http://localhost:8080/ServidorRemoto/rest/customer/findByName?name=XXXX,
                 * se llama a la aplicaci칩n propia (AjaxCliente) pas치ndole el 
                 * valor del par치metro imput de texto
                */
                var entradaTextoLat = document.getElementById("entradaTextoLat");
                var entradaTextoLong = document.getElementById("entradaTextoLong");
                var ajaxURL =
                        "http://localhost:8080/ClienteProyecto9/web/proxy/" + entradaTextoLat.value +"/"+entradaTextoLong.value;
                xmlhttp.onreadystatechange = funcionCambioEstado;
                xmlhttp.open("GET", ajaxURL, true);
                xmlhttp.send();
            }

            function funcionCambioEstado() {
                if (this.readyState === 4 &amp;&amp; this.status === 200) {
                    var respuestaCadenaJSON = this.responseText;
                    var respuestaObjetoJSON = JSON.parse(respuestaCadenaJSON);
                    var textoMostrar = funcionArrayCustomersJsonACadenaHTML(respuestaObjetoJSON);
                    var contenedorAjax = document.getElementById("contenedorAjax");
                    //como es un Div, puedo modificar su propiedad innerHTML:
                    contenedorAjax.innerHTML = "Respuesta recibida correctamente: " + textoMostrar;
                    
                }else if (this.readyState === 4){
                    var contenedorAjax = document.getElementById("contenedorAjax");
                    //como es un Div, puedo modificar su propiedad innerHTML:
                    contenedorAjax.innerHTML = "Error en la petici&oacute;n: " + this.status;
                }
            }
            
            function funcionArrayCustomersJsonACadenaHTML(elementoJSON) {
//                var textoHTML = "<ul>";
//                for(i=0;i&lt;elementoJSON.length;i++){
//                    textoHTML += "<li>Direcciones: "+elementoJSON.results[i].formatted_address+"</li>";
//                }
//                textoHTML += "</ul>";
                if(elementoJSON.results.length &gt; 0){
                    textoHTML = elementoJSON.results[0].formatted_address;
                }else{
                    textoHTML = "NO EXISTE NINGUNA DIRECCION"
                }
                
                return textoHTML;
            }
        </script>
    </h:head>
    <h:body>
        <h:form>
        <h:commandButton action="#{usuario.pagregistro()}" value="Registrarse"/><br/><br/>
        </h:form>
        <f:view>
            <h:form>
                <h:outputText value="Usuario"/><h:inputText value="#{usuario.usuario.username}" />
                <h:outputText value="Contrase침a"/><h:inputSecret value="#{usuario.usuario.password}" />
                <h:commandButton value="Aceptar" action="#{usuario.loginUsuario()}"/>
                <h:messages style="color:red" />
            </h:form>
        </f:view>
        <div>TODO write content</div>
        <input type="text" value="12.0239" id="entradaTextoLat"/>
        <input type="text" value="13.3242" id="entradaTextoLong"/>
        <input type="button" value="Ajax" onclick="llamarServidorRemoto();"/>
        <h1>Respuesta Ajax:</h1>
        <div id="contenedorAjax" ></div>
       
    </h:body>
</html>

